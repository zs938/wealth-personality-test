<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¢å¯Œæµ‹è¯•æ•°æ®åˆ†æ</title>
    <style>
        body { 
            font-family: 'Microsoft YaHei', sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
        }
        .stat-number { 
            font-size: 2.5em; 
            font-weight: bold; 
            margin: 10px 0; 
        }
        .chart-container { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            border: 1px solid #ddd; 
        }
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        .data-table th, .data-table td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left; 
        }
        .data-table th { 
            background: #f5f5f5; 
        }
        .refresh-btn { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-bottom: 20px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’° è´¢å¯Œæµ‹è¯•æ•°æ®åˆ†æçœ‹æ¿</h1>
        
        <button class="refresh-btn" onclick="loadAnalyticsData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>æ€»è®¿é—®é‡</h3>
                <div class="stat-number" id="total-views">0</div>
                <p>é¡µé¢æµè§ˆæ¬¡æ•°</p >
            </div>
            <div class="stat-card">
                <h3>æµ‹è¯•å®Œæˆæ•°</h3>
                <div class="stat-number" id="completed-tests">0</div>
                <p>å®Œæˆçš„æµ‹è¯•æ•°é‡</p >
            </div>
            <div class="stat-card">
                <h3>å®Œæˆç‡</h3>
                <div class="stat-number" id="completion-rate">0%</div>
                <p>è®¿é—®åˆ°å®Œæˆçš„æ¯”ä¾‹</p >
            </div>
            <div class="stat-card">
                <h3>å¹³å‡ç”¨æ—¶</h3>
                <div class="stat-number" id="avg-duration">0s</div>
                <p>å¹³å‡æµ‹è¯•æ—¶é—´</p >
            </div>
        </div>
        
        <div class="chart-container">
            <h3>ğŸ“Š äººæ ¼ç±»å‹åˆ†å¸ƒ</h3>
            <div id="personality-chart">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>äººæ ¼ç±»å‹</th>
                            <th>æ•°é‡</th>
                            <th>ç™¾åˆ†æ¯”</th>
                        </tr>
                    </thead>
                    <tbody id="personality-table">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="chart-container">
            <h3>ğŸ“ˆ æ¯æ—¥æ´»è·ƒåº¦</h3>
            <div id="daily-activity">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ</th>
                            <th>è®¿é—®é‡</th>
                            <th>å®Œæˆæµ‹è¯•</th>
                        </tr>
                    </thead>
                    <tbody id="daily-table">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="chart-container">
            <h3>ğŸ¯ ç‰ˆæœ¬ä½¿ç”¨æƒ…å†µ</h3>
            <div id="version-usage">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æµ‹è¯•ç‰ˆæœ¬</th>
                            <th>ä½¿ç”¨æ¬¡æ•°</th>
                            <th>æ¯”ä¾‹</th>
                        </tr>
                    </thead>
                    <tbody id="version-table">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="chart-container">
            <h3>ğŸ•’ æœ€è¿‘æ´»åŠ¨</h3>
            <div id="recent-activity" style="max-height: 400px; overflow-y: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>äº‹ä»¶ç±»å‹</th>
                            <th>è¯¦æƒ…</th>
                        </tr>
                    </thead>
                    <tbody id="activity-table">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function loadAnalyticsData() {
            try {
                const response = await fetch('get-analytics.php');
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥');
            }
        }
        
        function updateDashboard(data) {
            // æ›´æ–°åŸºç¡€ç»Ÿè®¡
            document.getElementById('total-views').textContent = data.totalViews.toLocaleString();
            document.getElementById('completed-tests').textContent = data.completedTests.toLocaleString();
            document.getElementById('completion-rate').textContent = data.completionRate + '%';
            document.getElementById('avg-duration').textContent = Math.round(data.avgDuration / 1000) + 's';
            
            // æ›´æ–°äººæ ¼ç±»å‹åˆ†å¸ƒ
            updatePersonalityChart(data.personalityDistribution);
            
            // æ›´æ–°æ¯æ—¥æ´»è·ƒåº¦
            updateDailyActivity(data.dailyActivity);
            
            // æ›´æ–°ç‰ˆæœ¬ä½¿ç”¨æƒ…å†µ
            updateVersionUsage(data.versionUsage);
            
            // æ›´æ–°æœ€è¿‘æ´»åŠ¨
            updateRecentActivity(data.recentActivity);
        }
        
        function updatePersonalityChart(distribution) {
            const tableBody = document.getElementById('personality-table');
            tableBody.innerHTML = '';
            
            const total = Object.values(distribution).reduce((sum, count) => sum + count, 0);
            
            Object.entries(distribution).forEach(([type, count]) => {
                const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${type}</td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateDailyActivity(dailyData) {
            const tableBody = document.getElementById('daily-table');
            tableBody.innerHTML = '';
            
            Object.entries(dailyData).forEach(([date, stats]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${stats.views || 0}</td>
                    <td>${stats.completions || 0}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateVersionUsage(versionData) {
            const tableBody = document.getElementById('version-table');
            tableBody.innerHTML = '';
            
            const total = Object.values(versionData).reduce((sum, count) => sum + count, 0);
            
            Object.entries(versionData).forEach(([version, count]) => {
                const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${version}</td>
                    <td>${count}</td>
                    <td>${percentage}%</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function updateRecentActivity(activities) {
            const tableBody = document.getElementById('activity-table');
            tableBody.innerHTML = '';
            
            activities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(activity.timestamp).toLocaleString()}</td>
                    <td>${activity.type}</td>
                    <td>${JSON.stringify(activity.details)}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
        document.addEventListener('DOMContentLoaded', loadAnalyticsData);
        
        // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
        setInterval(loadAnalyticsData, 5 * 60 * 1000);
    </script>
</body>
</html>